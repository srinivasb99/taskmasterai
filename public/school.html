<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Web Gateway</title>
    <style>
        /* Previous CSS styles remain unchanged */
        :root {
            --bg-color: #1a1a1a;
            --header-color: #2d2d2d;
            --accent-color: #00cc88;
        }

        body {
            background: var(--bg-color);
            color: #fff;
            height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--header-color);
            padding: 1rem;
            border-bottom: 1px solid #444;
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .nav-btn {
            padding: 0.5rem 1rem;
            background: #3a3a3a;
            border: 1px solid #4a4a4a;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-box {
            padding: 1rem;
            background: #252525;
            display: flex;
            gap: 0.5rem;
        }

        #urlInput {
            flex: 1;
            padding: 0.8rem;
            background: #333;
            border: 1px solid #444;
            color: #fff;
            border-radius: 4px;
            font-size: 1rem;
        }

        #proxyFrame {
            flex: 1;
            border: none;
            background: #fff;
        }

        .status-bar {
            padding: 0.5rem 1rem;
            background: #252525;
            color: #888;
        }

        .error-message {
            color: #ff4444;
            padding: 1rem;
            display: none;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîí Secure Web Gateway</h1>
        <div class="controls">
            <button class="nav-btn" id="backBtn">‚Üê Back</button>
            <button class="nav-btn" id="forwardBtn">Forward ‚Üí</button>
            <button class="nav-btn" id="refreshBtn">‚Üª Refresh</button>
            <button class="nav-btn" id="newSessionBtn">üîÑ New Session</button>
        </div>
    </div>

    <div class="search-box">
        <input type="url" id="urlInput" placeholder="Enter website URL (e.g., example.com)">
        <button class="nav-btn" id="goBtn">Go</button>
    </div>

    <div class="status-bar" id="statusBar">Ready</div>
    <div class="error-message" id="errorMessage"></div>
    <iframe 
        id="proxyFrame"
        sandbox="allow-forms allow-scripts allow-same-origin allow-popups"
        referrerpolicy="no-referrer-when-downgrade"
    ></iframe>

    <script>
    (function() {
        const PROXY_BASE = 'https://croxyproxy.vip';
        const iframe = document.getElementById('proxyFrame');
        const urlInput = document.getElementById('urlInput');
        const statusBar = document.getElementById('statusBar');
        const errorMessage = document.getElementById('errorMessage');
        
        let currentUrl = PROXY_BASE;
        let historyStack = [PROXY_BASE];
        let historyPointer = 0;

        // Initialize proxy
        function initProxy() {
            iframe.src = PROXY_BASE;
            updateStatus('Connected to proxy network');
        }

        // Handle navigation
        function navigateToUrl(target) {
            try {
                const cleanUrl = target.startsWith('http') ? target : `https://${target}`;
                const encodedUrl = btoa(cleanUrl).replace(/=+$/, '');
                const proxyUrl = `${PROXY_BASE}/?__cpo=${encodedUrl}`;
                
                historyStack = historyStack.slice(0, historyPointer + 1);
                historyStack.push(proxyUrl);
                historyPointer++;
                
                iframe.src = proxyUrl;
                updateStatus(`Loading: ${cleanUrl}`);
                
            } catch(error) {
                showError('Invalid URL format');
            }
        }

        // Update UI state
        function updateStatus(message) {
            statusBar.textContent = message;
            errorMessage.style.display = 'none';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            statusBar.textContent = 'Error occurred';
        }

        // Handle messages from proxy
        window.addEventListener('message', (event) => {
            try {
                if (event.origin.startsWith(PROXY_BASE) || 
                    event.origin.startsWith('https://') && event.data) {
                    
                    const currentProxyUrl = iframe.src;
                    urlInput.value = new URL(currentProxyUrl).searchParams.get('__cpo') 
                        ? atob(new URL(currentProxyUrl).searchParams.get('__cpo'))
                        : currentProxyUrl;
                }
            } catch(error) {
                console.warn('Message handling error:', error);
            }
        });

        // Event listeners
        document.getElementById('goBtn').addEventListener('click', () => {
            const target = urlInput.value.trim();
            if (target) navigateToUrl(target);
        });

        document.getElementById('backBtn').addEventListener('click', () => {
            if (historyPointer > 0) {
                historyPointer--;
                iframe.src = historyStack[historyPointer];
                updateStatus('Navigating back');
            }
        });

        document.getElementById('forwardBtn').addEventListener('click', () => {
            if (historyPointer < historyStack.length - 1) {
                historyPointer++;
                iframe.src = historyStack[historyPointer];
                updateStatus('Navigating forward');
            }
        });

        document.getElementById('refreshBtn').addEventListener('click', () => {
            iframe.contentWindow.location.reload();
            updateStatus('Refreshing page');
        });

        document.getElementById('newSessionBtn').addEventListener('click', () => {
            historyStack = [PROXY_BASE];
            historyPointer = 0;
            initProxy();
            updateStatus('New session started');
        });

        // Initialize
        initProxy();
    })();
    </script>
</body>
</html>
